# Nginx config snippet to serve HLS mosaics from the Jellyfin plugin
# Place this inside the `server` block of your Jellyfin reverse proxy configuration.

location /mosaics/ {
    # This path MUST match the `WorkspacePath` in the plugin configuration.
    alias /var/lib/jellyfin/mosaics/;

    # HLS files require specific headers
    types {
        application/vnd.apple.mpegurl m3u8;
        video/mp2t ts;
    }

    # Disable caching for live playlists
    add_header Cache-Control no-cache;

    # CORS headers to allow playback in browsers
    add_header 'Access-Control-Allow-Origin' '*' always;
    add_header 'Access-Control-Allow-Methods' 'GET, HEAD, OPTIONS' always;
    add_header 'Access-Control-Allow-Headers' 'Range' always;

    # Respond to preflight requests
    if ($request_method = 'OPTIONS') {
        return 204;
    }
}
